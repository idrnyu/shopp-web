name: CI  # 任务名称

# 事件
on:
  # push master 分支的时候触发；
  push:
    branches: [ master ]

# 工作流运行由一个或多个任务组成，这些任务按顺序或并行运行
jobs:
  # 工作流包含一个 build 的任务
  build:
    # build 任务运行环境为 ubuntu 最新版
    runs-on: ubuntu-latest
    
    # 任务步骤
    steps:
      # actions 拉代码到当前环境
      - name: git checkout
        uses: actions/checkout@v3
      
      # 设置 node 环境  如果不知道可以再 Marketplace 下搜索
      - name: install NodeJs env
        uses: actions/setup-node@v3
        # 安装 node 的具体命令
        with:
          node-version: "16.13.x"
      
      # 给项目安装依赖
      - name: npm install
        run: npm install
      
      # 打包项目
      - name: npm run build
        run: npm run build

      # 将打包好的dist文件复制到项目
      # - name: 复制打包好的文件到新分支
      #   run: |
      #     pwd
      #     ls -l
      #     git push origin --delete www
      #     cd ./dist
      #     git config --global user.email "834999326@qq.com"
      #     git config --global user.name idrnyu-ci
      #     git init
      #     git add .
      #     git commit -m "build out dist commit"
      #     git remote add origin https://github.com/idrnyu/shopp-web.git
      #     git pull
      #     git checkout -b www
      #     git push --set-upstream origin www

    deploy:
      type: git   # 使用 Git 提交
      # repository: git@github.com:idrnyu/idrnyu.github.io.git  # 提交到的仓库   SSH 
      repo: https://github.com/idrnyu/shopp-web.git
      branch: www  # 提交到 www 分支
      # message: 添加域名解析

        
        
        
        
  
